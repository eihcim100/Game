<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Golden Spade Casino</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /*-- Casino Theme Styles --*/
      body {
        font-family: 'Lato', sans-serif;
        background-color: #1a1a1a;
        color: #e0e0e0;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%233a3a3a' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        overflow-x: hidden;
      }

      .container {
        width: 95%;
        max-width: 900px;
        padding: 2.5rem;
        background-color: rgba(10, 10, 10, 0.85);
        border-radius: 1.5rem;
        box-shadow: 0 0 40px rgba(255, 215, 0, 0.2);
        text-align: center;
        border: 2px solid #D4AF37; /* Gold border */
        backdrop-filter: blur(10px);
      }

      .logo-container {
          display: flex;
          justify-content: center;
          align-items: center;
          margin-bottom: 1.5rem;
      }

      .logo-icon {
          width: 60px;
          height: 60px;
          margin-right: 1rem;
          filter: drop-shadow(0 0 10px #D4AF37);
      }

      h1, h2, h3 {
        font-family: 'Cinzel', serif;
        color: #D4AF37; /* Gold color */
        text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
      }

      h1 {
        font-size: 3.5rem;
        margin-bottom: 0.5rem;
      }
      h2 {
        font-size: 2.2rem;
        margin-bottom: 1.5rem;
      }
       h3 {
        font-size: 1.8rem;
        margin-bottom: 1rem;
      }


      p {
        font-size: 1rem;
        margin-bottom: 1.5rem;
        color: #c7c7c7;
        line-height: 1.7;
      }

      button {
        padding: 1rem 2rem;
        font-size: 1.1rem;
        margin: 0.75rem;
        cursor: pointer;
        border-radius: 0.75rem;
        transition: all 0.3s ease-in-out;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5), inset 0 -2px 5px rgba(0,0,0,0.4);
        border: 2px solid #D4AF37;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        background: linear-gradient(145deg, #c81e1e, #991414);
        color: #FFFFFF;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      button:hover {
        background: linear-gradient(145deg, #e02d2d, #b01a1a);
        transform: translateY(-4px) scale(1.03);
        box-shadow: 0 8px 25px rgba(255, 0, 0, 0.3), inset 0 -2px 5px rgba(0,0,0,0.4);
      }
      button:disabled{
        background: #555;
        border-color: #444;
        cursor: not-allowed;
        opacity: 0.6;
        transform: none;
        box-shadow: none;
        color: #999;
      }
      
      button .icon {
          margin-right: 0.75rem;
          width: 24px;
          height: 24px;
      }

      input[type="number"], input[type="text"] {
        padding: 1rem;
        font-size: 1.1rem;
        border-radius: 0.75rem;
        border: 2px solid #555;
        margin: 0.75rem;
        width: 80%;
        max-width: 400px;
        background-color: #2a2a2a;
        color: #e0e0e0;
        box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.4);
      }

      input:focus {
        outline: none;
        border-color: #D4AF37;
        box-shadow: 0 0 0 5px rgba(212, 175, 55, 0.2);
      }

      .message-box {
        margin-top: 2rem;
        padding: 1.5rem;
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 1rem;
        border: 1px solid #444;
        text-align: center;
        font-size: 1.1rem;
        color: #D4AF37;
        font-weight: 700;
        min-height: 50px;
      }
       .hidden {
        display: none;
      }

      .game-button {
        background: linear-gradient(145deg, #1e63c8, #144299);
        border-color: #3b82f6;
      }

      .game-button:hover {
        background: linear-gradient(145deg, #2d73e0, #1a52b0);
        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3), inset 0 -2px 5px rgba(0,0,0,0.4);
      }
      
      .winning-message { color: #22c55e; }
      .losing-message { color: #ef4444; }

      .card {
        width: 90px;
        height: 120px;
        border-radius: 12px;
        border: 2px solid #999;
        margin: 15px;
        font-size: 1.6rem;
        font-weight: 700;
        background-color: #f0f0f0;
        color: #1a1a1a;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.5);
        padding: 8px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
      }
      .card .value { font-size: 2rem; line-height: 1; }
      .card .suit { font-size: 1.4rem; }
      .red { color: #ef4444; }
      .black { color: #1a1a1a; }

      .blackjack-card {
        width: 70px;
        height: 100px;
        border-radius: 10px;
        border: 1px solid #999;
        margin: 8px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        font-size: 1rem;
        font-weight: 600;
        background-color: #f0f0f0;
        color: #1a1a1a;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        padding: 6px;
      }
      .blackjack-card .value { font-size: 1.4rem; line-height: 1; }
      .blackjack-card .suit { font-size: 1rem; }
      .blackjack-red { color: #ef4444; }
      .blackjack-black { color: #1a1a1a; }

      #blackjack-hand-player, #blackjack-hand-dealer {
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          margin-bottom: 20px;
          min-height: 110px;
          gap: 10px;
          padding: 1rem;
          background: rgba(0, 100, 0, 0.3);
          border-radius: 1rem;
          border: 1px solid #006400;
      }

      /* Deal or No Deal Specific Styles */
      #sequence-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        padding: 1rem;
        background: rgba(0,0,0,0.2);
        border-radius: 1rem;
        margin-top: 1rem;
      }
      .sequence-card {
        width: 45px;
        height: 45px;
        border-radius: 8px;
        border: 1px solid #555;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1rem;
        font-weight: 700;
        background-color: #333;
        color: #ccc;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
      }
      .sequence-card.revealed {
        background-color: #D4AF37;
        color: #1a1a1a;
        border-color: #fff;
      }
      .sequence-card.player-choice {
        background-color: #1e63c8;
        color: #fff;
        border-color: #3b82f6;
      }


      #ledger-container {
        margin-top: 3rem;
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 1.25rem;
        padding: 2rem;
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #444;
        box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.5);
      }

      .ledger-entry {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.9rem 0;
        border-bottom: 1px dashed #555;
        font-size: 0.95rem;
      }
      .ledger-entry:last-child { border-bottom: none; }
      .ledger-entry .timestamp { color: #888; width: 160px; text-align: left; }
      .ledger-entry .description { flex-grow: 1; text-align: left; margin-left: 20px; margin-right: 20px; color: #ccc; }
      .ledger-entry .amount { font-weight: 700; width: 100px; text-align: right; }
      .ledger-entry.positive .amount { color: #22c55e; }
      .ledger-entry.negative .amount { color: #ef4444; }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal-content {
        background: linear-gradient(145deg, #2c2c2c, #1a1a1a);
        padding: 2.5rem;
        border-radius: 1rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        max-width: 500px;
        width: 90%;
        color: #e0e0e0;
        text-align: center;
        border: 2px solid #D4AF37;
      }
      
      #balance-info p {
        margin-bottom: 0.5rem;
        font-size: 1.1rem;
      }
      #balance-info #player-balance {
        font-size: 1.5rem;
        font-weight: 700;
        color: #22c55e;
      }
      
      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
      }
      
      .info-box {
        background: rgba(255,255,255,0.05);
        padding: 0.75rem;
        border-radius: 0.5rem;
        border: 1px solid #444;
      }
      
      .info-box p {
        margin: 0;
        font-size: 0.9rem;
        color: #aaa;
      }
      
      .info-box span {
        display: block;
        font-size: 1.2rem;
        font-weight: 700;
        color: #D4AF37;
      }

      .disclaimer {
        font-family: 'Lato', sans-serif;
        font-size: 0.75rem;
        color: #777;
        text-align: center;
        margin: 0;
        padding: 0;
      }

      @media (max-width: 768px) {
        h1 { font-size: 2.5rem; }
        .logo-icon { width: 40px; height: 40px; }
        .container { padding: 1.5rem; }
        button { font-size: 1rem; padding: 0.8rem 1.5rem; }
      }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-container">
            <svg class="logo-icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" fill="#D4AF37"><path d="M256 0C114.6 0 0 114.6 0 256s114.6 256 256 256 256-114.6 256-256S397.4 0 256 0zm-54.3 128h108.6c13.3 0 24 10.7 24 24v23.4c0 16.2-13.2 29.4-29.4 29.4h-10.2c-16.2 0-29.4 13.2-29.4 29.4v34.8c0 16.2-13.2 29.4-29.4 29.4S182.3 305.2 182.3 289V152c0-13.3 10.7-24 24-24zm112.6 256H197.7c-13.3 0-24-10.7-24-24v-23.4c0-16.2 13.2-29.4 29.4-29.4h10.2c16.2 0 29.4-13.2 29.4-29.4v-34.8c0-16.2 13.2-29.4 29.4-29.4s29.4 13.2 29.4 29.4V360c0 13.3-10.7 24-24 24z"/></svg>
            <h1>The Golden Spade</h1>
        </div>
        <p>Welcome to the most exclusive casino on the web. Fortune favors the bold. Are you bold enough?</p>
        <p>Please enter your initial deposit to start playing.</p>

        <input type="number" id="initial-deposit" placeholder="Enter Deposit Amount">
        <button id="deposit-button">
            <svg class="icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd"></path></svg>
            Deposit Funds
        </button>

        <div id="balance-info" class="mt-8 hidden">
             <p>Player Balance: <span id="player-balance">$0.00</span></p>
             <div class="info-grid mt-4">
                <div class="info-box"><p>Tariff Fund</p><span id="tariff-balance">$0.00</span></div>
                <div class="info-box"><p>Hardship Fund</p><span id="hardship-balance">$0.00</span></div>
                <div class="info-box"><p>Net P/L</p><span id="net-profit-loss">$0.00</span></div>
                <div class="info-box"><p>Casino Profit</p><span id="casino-total-profit">$0.00</span></div>
             </div>
        </div>

        <div id="game-selection" class="mt-6 hidden">
            <h2>Select a Game</h2>
            <button class="game-button" id="blackjack-button">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 15.536A9.004 9.004 0 0112 15c-2.485 0-4.735.994-6.364 2.636M12 9a4 4 0 100 8 4 4 0 000-8zM12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9-4.03-9-9-9z"></path></svg>
                Blackjack
            </button>
            <button class="game-button" id="red-black-button">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                Red or Black
            </button>
            <button class="game-button" id="deal-or-no-deal-button">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"></path></svg>
                Deal or No Deal
            </button>
        </div>

        <div id="game-container" class="mt-6">
            <div id="blackjack-game" class="hidden">
                <h2>Blackjack</h2>
                <div id="blackjack-hand-dealer">
                    <p>Dealer Hand:</p>
                </div>
                <div id="blackjack-hand-player">
                    <p>Your Hand:</p>
                </div>
                <p>Place your bet:</p>
                <input type="number" id="blackjack-bet" placeholder="Enter Total Bet Amount">
                <div class="mt-2 mb-2">
                    <input type="checkbox" id="blackjack-insurance-checkbox" class="mr-2 align-middle">
                    <label for="blackjack-insurance-checkbox" class="align-middle">Buy Insurance (45% of wager, built into bet)</label>
                </div>
                <div id="blackjack-buttons">
                    <button id="blackjack-hit">Hit</button>
                    <button id="blackjack-stand">Stand</button>
                    <button id="blackjack-play">Play Hand</button>
                </div>
                <div id="blackjack-result" class="mt-4 text-lg"></div>
            </div>

            <div id="red-black-game" class="hidden">
                <h2>Red or Black</h2>
                <p>Place your bet:</p>
                <input type="number" id="red-black-bet" placeholder="Enter Total Bet Amount">
                <div class="mt-2 mb-2">
                    <input type="checkbox" id="red-black-insurance-checkbox" class="mr-2 align-middle">
                    <label for="red-black-insurance-checkbox" class="align-middle">Buy Insurance (45% of wager, built into bet)</label>
                </div>
                <p>Choose a color:</p>
                <button id="red-button" style="background: linear-gradient(145deg, #c81e1e, #991414); border-color: #ef4444;">Red</button>
                <button id="black-button" style="background: linear-gradient(145deg, #333, #111); border-color: #555;">Black</button>
                <div id="red-black-result" class="mt-4 text-lg"></div>
            </div>

            <div id="deal-or-no-deal-game" class="hidden">
                <h2>Deal or No Deal</h2>
                <p>Choose your number (1-20):</p>
                <input type="number" id="deal-or-no-deal-number" placeholder="Enter Number (1-20)">
                 <p>Place your bet:</p>
                <input type="number" id="deal-or-no-deal-bet" placeholder="Enter Total Bet Amount">
                <div class="mt-2 mb-2">
                    <input type="checkbox" id="dond-insurance-checkbox" class="mr-2 align-middle">
                    <label for="dond-insurance-checkbox" class="align-middle">Buy Insurance (45% of wager, built into bet)</label>
                </div>
                <button id="start-sequence-button">Start Game</button>
                <div id="sequence-container" class="mt-4"></div>
                <div id="deal-or-no-deal-result" class="mt-4 text-lg"></div>
                <div id="deal-or-no-deal-options" class="mt-4 hidden"></div>
            </div>
        </div>

        <div id="action-buttons" class="mt-6 hidden">
            <h2>Special Actions</h2>
            <button id="withdraw-button">
                 <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5l-3-3m0 0l-3 3m3-3v12"></path></svg>
                Withdraw Funds
            </button>
        </div>

        <div id="message-box" class="mt-6 text-center"></div>

        <div id="ledger-container" class="hidden">
            <h2>Transaction Ledger</h2>
            <div id="ledger-display"></div>
        </div>

        <p class="disclaimer mt-8">(This casino is not real, and is for entertainment purposes only)</p>

    </div>

    <script>
        // Game State Variables
        let playerBalance = 0;
        let tariffBalance = 0;
        let hardshipBalance = 0;
        let playerNetProfitLoss = 0;
        let gameActive = false;
        let totalCasinoProfit = 0;
        let transactionHistory = [];
        let dealOrNoDealGame = null;

        // DOM Elements
        const messageBox = document.getElementById('message-box');
        const depositButton = document.getElementById('deposit-button');
        const initialDepositInput = document.getElementById('initial-deposit');
        const balanceDisplay = document.getElementById('balance-info');
        const playerBalanceDisplay = document.getElementById('player-balance');
        const tariffBalanceDisplay = document.getElementById('tariff-balance');
        const hardshipBalanceDisplay = document.getElementById('hardship-balance');
        const netProfitLossDisplay = document.getElementById('net-profit-loss');
        const casinoTotalProfitDisplay = document.getElementById('casino-total-profit');
        const gameSelection = document.getElementById('game-selection');
        const blackjackButton = document.getElementById('blackjack-button');
        const redBlackButton = document.getElementById('red-black-button');
        const dealOrNoDealButton = document.getElementById('deal-or-no-deal-button');
        const actionButtons = document.getElementById('action-buttons');
        const withdrawButton = document.getElementById('withdraw-button');

        const blackjackGameContainer = document.getElementById('blackjack-game');
        const blackjackHandDealerDisplay = document.getElementById('blackjack-hand-dealer');
        const blackjackHandPlayerDisplay = document.getElementById('blackjack-hand-player');
        const blackjackBetInput = document.getElementById('blackjack-bet');
        const blackjackHitButton = document.getElementById('blackjack-hit');
        const blackjackStandButton = document.getElementById('blackjack-stand');
        const blackjackPlayButton = document.getElementById('blackjack-play');
        const blackjackResultDisplay = document.getElementById('blackjack-result');

        const redBlackGameContainer = document.getElementById('red-black-game');
        const redBlackBetInput = document.getElementById('red-black-bet');
        const redButton = document.getElementById('red-button');
        const blackButton = document.getElementById('black-button');
        const redBlackResultDisplay = document.getElementById('red-black-result');

        const dealOrNoDealGameContainer = document.getElementById('deal-or-no-deal-game');
        const dealOrNoDealNumberInput = document.getElementById('deal-or-no-deal-number');
        const dealOrNoDealBetInput = document.getElementById('deal-or-no-deal-bet');
        const startSequenceButton = document.getElementById('start-sequence-button');
        const sequenceContainer = document.getElementById('sequence-container');
        const dealOrNoDealResultDisplay = document.getElementById('deal-or-no-deal-result');
        const dealOrNoDealOptions = document.getElementById('deal-or-no-deal-options');

        const ledgerContainer = document.getElementById('ledger-container');
        const ledgerDisplay = document.getElementById('ledger-display');
        
        // Event Listeners
        depositButton.addEventListener('click', handleDeposit);
        blackjackButton.addEventListener('click', () => showGame('blackjack'));
        redBlackButton.addEventListener('click', () => showGame('red-black'));
        dealOrNoDealButton.addEventListener('click', () => showGame('deal-or-no-deal'));
        withdrawButton.addEventListener('click', withdrawFunds);

        blackjackPlayButton.addEventListener('click', playBlackjackHand);
        blackjackHitButton.addEventListener('click', blackjackHit);
        blackjackStandButton.addEventListener('click', blackjackStand);
        redButton.addEventListener('click', () => playRedOrBlack('red'));
        blackButton.addEventListener('click', () => playRedOrBlack('black'));
        startSequenceButton.addEventListener('click', startDealOrNoDealGame);

        // --- Core Functions ---

        function updateBalanceDisplays() {
            playerBalanceDisplay.textContent = `$${playerBalance.toFixed(2)}`;
            tariffBalanceDisplay.textContent = `$${tariffBalance.toFixed(2)}`;
            hardshipBalanceDisplay.textContent = `$${hardshipBalance.toFixed(2)}`;
            netProfitLossDisplay.textContent = `$${playerNetProfitLoss.toFixed(2)}`;
            casinoTotalProfitDisplay.textContent = `$${totalCasinoProfit.toFixed(2)}`;

            netProfitLossDisplay.style.color = playerNetProfitLoss >= 0 ? '#22c55e' : '#ef4444';
            casinoTotalProfitDisplay.style.color = totalCasinoProfit >= 0 ? '#22c55e' : '#ef4444';
        }

        function addTransaction(type, amount, description) {
            const timestamp = new Date().toLocaleString();
            transactionHistory.push({ timestamp, type, amount, description });
            updateLedgerDisplay();
        }

        function updateLedgerDisplay() {
            ledgerDisplay.innerHTML = '';
            transactionHistory.slice().reverse().forEach(entry => {
                const entryDiv = document.createElement('div');
                entryDiv.classList.add('ledger-entry', entry.amount >= 0 ? 'positive' : 'negative');
                entryDiv.innerHTML = `
                    <span class="timestamp">${entry.timestamp}</span>
                    <span class="description">${entry.description}</span>
                    <span class="amount">${entry.amount >= 0 ? '+' : ''}$${entry.amount.toFixed(2)}</span>
                `;
                ledgerDisplay.appendChild(entryDiv);
            });
            ledgerContainer.classList.remove('hidden');
        }

        function handleDeposit() {
            const depositAmount = parseFloat(initialDepositInput.value);
            if (isNaN(depositAmount) || depositAmount <= 0) {
                messageBox.textContent = 'Invalid deposit amount.';
                return;
            }
            playerBalance += depositAmount;
            addTransaction('deposit', depositAmount, `Initial deposit`);
            balanceDisplay.classList.remove('hidden');
            gameSelection.classList.remove('hidden');
            actionButtons.classList.remove('hidden');
            updateBalanceDisplays();
            messageBox.textContent = `Deposit of $${depositAmount.toFixed(2)} successful!`;
            initialDepositInput.value = '';
            depositButton.classList.add('hidden');
            initialDepositInput.classList.add('hidden');
            document.querySelector('p:nth-of-type(2)').classList.add('hidden');
        }

        function showGame(gameName) {
            gameActive = true;
            blackjackGameContainer.classList.add('hidden');
            redBlackGameContainer.classList.add('hidden');
            dealOrNoDealGameContainer.classList.add('hidden');

            switch (gameName) {
                case 'blackjack':
                    blackjackGameContainer.classList.remove('hidden');
                    resetBlackjackUI();
                    break;
                case 'red-black':
                    redBlackGameContainer.classList.remove('hidden');
                    redBlackResultDisplay.textContent = '';
                    break;
                case 'deal-or-no-deal':
                    dealOrNoDealGameContainer.classList.remove('hidden');
                    resetDealOrNoDealUI();
                    break;
            }
            messageBox.textContent = '';
        }
        
        function resetBlackjackUI() {
            blackjackPlayButton.disabled = false;
            blackjackHitButton.disabled = true;
            blackjackStandButton.disabled = true;
            blackjackResultDisplay.textContent = '';
            blackjackHandPlayerDisplay.innerHTML = '<p>Your Hand:</p>';
            blackjackHandDealerDisplay.innerHTML = '<p>Dealer Hand:</p>';
        }

        function resetDealOrNoDealUI() {
            dealOrNoDealOptions.classList.add('hidden');
            dealOrNoDealResultDisplay.textContent = '';
            sequenceContainer.innerHTML = '';
            startSequenceButton.disabled = false;
        }

        function calculateWagerFromTotalRisk(totalRiskAmount, insuranceSelected) {
            const BASE_HOUSE_FEE_RATE = 0.15;
            const INSURANCE_RATE = 0.45;

            let divisor = 1 + BASE_HOUSE_FEE_RATE;
            if (insuranceSelected) {
                divisor += INSURANCE_RATE;
            }

            if (totalRiskAmount <= 0 || isNaN(totalRiskAmount)) return null;

            const wager = totalRiskAmount / divisor;
            const houseFee = wager * BASE_HOUSE_FEE_RATE;
            const insuranceCost = insuranceSelected ? wager * INSURANCE_RATE : 0;

            return { wager, houseFee, insuranceCost };
        }

        function handleGameEnd(gameName, playerWon, winnings, wager, insurancePurchased, additionalMessage = '') {
            const TARIFF_RATE = 0.10;
            let tariffAmount = 0;
            let netWinnings = 0;
            let profit = winnings - wager;

            if (playerWon && profit > 0) {
                tariffAmount = profit * TARIFF_RATE;
                tariffBalance += tariffAmount;
                netWinnings = winnings - tariffAmount;
                
                playerBalance += netWinnings;
                playerNetProfitLoss += (netWinnings - wager);
                totalCasinoProfit -= profit;

                addTransaction('win_payout', winnings, `${gameName} gross winnings`);
                addTransaction('tariff_deduction', -tariffAmount, `Tariff (${(TARIFF_RATE*100)}%)`);
                messageBox.textContent = `You won! Net Payout: $${(netWinnings-wager).toFixed(2)} (after $${tariffAmount.toFixed(2)} tariff). ${additionalMessage}`;

            } else if (playerWon && profit === 0) {
                 playerBalance += wager;
                 messageBox.textContent = `It's a push! Your wager of $${wager.toFixed(2)} is returned. ${additionalMessage}`;
                 addTransaction('push_return', wager, `${gameName} push, wager returned.`);

            } else {
                totalCasinoProfit += wager;
                let finalMessage = `You lost $${wager.toFixed(2)}.`;

                if (insurancePurchased) {
                    playerBalance += wager;
                    playerNetProfitLoss += wager;
                    totalCasinoProfit -= wager;
                    finalMessage = `You lost, but insurance refunded your wager of $${wager.toFixed(2)}!`;
                    addTransaction('insurance_payout', wager, `Insurance refund for ${gameName} loss.`);
                }
                
                if (tariffBalance > 0 && !insurancePurchased) {
                    const payoutAmount = Math.min(tariffBalance * 0.20, tariffBalance);
                    hardshipBalance += payoutAmount;
                    tariffBalance -= payoutAmount;
                    addTransaction('hardship_transfer', payoutAmount, `20% of Tariff Fund to Hardship Fund`);
                    finalMessage += ` $${payoutAmount.toFixed(2)} moved to your Hardship Fund.`;
                }
                messageBox.textContent = finalMessage + " " + additionalMessage;
            }

            updateBalanceDisplays();
            gameActive = false;
        }

        // --- Blackjack Game functions ---
        function generateBlackjackCard() {
            const suits = ['Hearts', 'Diamonds', 'Clubs', 'Spades'];
            const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            return { suit: suits[Math.floor(Math.random() * suits.length)], value: values[Math.floor(Math.random() * values.length)] };
        }

        function getBlackjackCardValue(card) {
            if (['J', 'Q', 'K'].includes(card.value)) return 10;
            if (card.value === 'A') return 11;
            return parseInt(card.value);
        }

        function calculateBlackjackHandValue(hand) {
            let sum = hand.reduce((acc, card) => acc + getBlackjackCardValue(card), 0);
            let numAces = hand.filter(card => card.value === 'A').length;
            while (sum > 21 && numAces > 0) {
                sum -= 10;
                numAces--;
            }
            return sum;
        }

        function displayBlackjackCard(card, handDisplay) {
            const cardDiv = document.createElement('div');
            cardDiv.classList.add('blackjack-card', card.suit === 'Hearts' || card.suit === 'Diamonds' ? 'blackjack-red' : 'blackjack-black');
            cardDiv.innerHTML = `<div class="value">${card.value}</div><div class="suit">${getSuitSymbol(card.suit)}</div>`;
            handDisplay.appendChild(cardDiv);
        }

        function getSuitSymbol(suit) {
            return { 'Hearts': '♥', 'Diamonds': '♦', 'Clubs': '♣', 'Spades': '♠' }[suit] || '';
        }

        function playBlackjackHand() {
            const totalBetAmount = parseFloat(blackjackBetInput.value);
            const insuranceSelected = document.getElementById('blackjack-insurance-checkbox').checked;

            if (totalBetAmount > playerBalance) {
                messageBox.textContent = `Insufficient funds. Your bet of $${totalBetAmount.toFixed(2)} exceeds your balance of $${playerBalance.toFixed(2)}.`;
                return;
            }

            const betComponents = calculateWagerFromTotalRisk(totalBetAmount, insuranceSelected);

            if (!betComponents) {
                messageBox.textContent = 'Invalid bet amount.';
                return;
            }

            const { wager, houseFee, insuranceCost } = betComponents;

            playerBalance -= totalBetAmount;
            playerNetProfitLoss -= totalBetAmount;
            totalCasinoProfit += houseFee + insuranceCost;

            addTransaction('bet_placement', -totalBetAmount, `Blackjack Bet: $${wager.toFixed(2)} (Fee: $${houseFee.toFixed(2)}, Ins: $${insuranceCost.toFixed(2)})`);
            updateBalanceDisplays();
            
            window.currentBlackjackGame = { wager, insurancePurchased: insuranceSelected };

            blackjackPlayButton.disabled = true;
            blackjackHitButton.disabled = false;
            blackjackStandButton.disabled = false;
            blackjackResultDisplay.textContent = '';
            blackjackHandPlayerDisplay.innerHTML = '<p>Your Hand:</p>';
            blackjackHandDealerDisplay.innerHTML = '<p>Dealer Hand:</p>';

            window.playerHand = [generateBlackjackCard(), generateBlackjackCard()];
            window.dealerHand = [generateBlackjackCard(), generateBlackjackCard()];

            displayBlackjackCard(window.playerHand[0], blackjackHandPlayerDisplay);
            displayBlackjackCard(window.playerHand[1], blackjackHandPlayerDisplay);
            displayBlackjackCard(window.dealerHand[0], blackjackHandDealerDisplay);
            
            const hiddenCardDiv = document.createElement('div');
            hiddenCardDiv.classList.add('blackjack-card');
            hiddenCardDiv.innerHTML = `<div class="value">?</div><div class="suit">🃏</div>`;
            blackjackHandDealerDisplay.appendChild(hiddenCardDiv);

            if (calculateBlackjackHandValue(window.playerHand) === 21) {
                blackjackResultDisplay.textContent = 'Blackjack! You win!';
                const winnings = window.currentBlackjackGame.wager * 2.5; // 3:2 payout
                handleGameEnd('Blackjack', true, winnings, window.currentBlackjackGame.wager, window.currentBlackjackGame.insurancePurchased);
                resetBlackjackUI();
            }
        }

        function blackjackHit() {
            window.playerHand.push(generateBlackjackCard());
            displayBlackjackCard(window.playerHand[window.playerHand.length - 1], blackjackHandPlayerDisplay);
            if (calculateBlackjackHandValue(window.playerHand) >= 21) {
                blackjackStand();
            }
        }

        function blackjackStand() {
            blackjackHitButton.disabled = true;
            blackjackStandButton.disabled = true;

            blackjackHandDealerDisplay.lastChild.remove();
            displayBlackjackCard(window.dealerHand[1], blackjackHandDealerDisplay);

            let dealerHandValue = calculateBlackjackHandValue(window.dealerHand);
            while (dealerHandValue < 17) {
                window.dealerHand.push(generateBlackjackCard());
                displayBlackjackCard(window.dealerHand[window.dealerHand.length - 1], blackjackHandDealerDisplay);
                dealerHandValue = calculateBlackjackHandValue(window.dealerHand);
            }

            const playerHandValue = calculateBlackjackHandValue(window.playerHand);
            const { wager, insurancePurchased } = window.currentBlackjackGame;
            let playerWon = false;
            let winnings = 0;

            if (playerHandValue > 21) {
                blackjackResultDisplay.textContent = 'You Bust! House wins!';
            } else if (dealerHandValue > 21 || playerHandValue > dealerHandValue) {
                blackjackResultDisplay.textContent = 'You win!';
                playerWon = true;
                winnings = wager * 2;
            } else if (playerHandValue === dealerHandValue) {
                blackjackResultDisplay.textContent = 'It\'s a push!';
                playerWon = true;
                winnings = wager; 
            } else {
                blackjackResultDisplay.textContent = 'House wins!';
            }
            handleGameEnd('Blackjack', playerWon, winnings, wager, insurancePurchased);
            resetBlackjackUI();
        }

        // --- Red or Black Game functions ---
        function playRedOrBlack(color) {
            const totalBetAmount = parseFloat(redBlackBetInput.value);
            const insuranceSelected = document.getElementById('red-black-insurance-checkbox').checked;

            if (totalBetAmount > playerBalance) {
                messageBox.textContent = `Insufficient funds. Your bet of $${totalBetAmount.toFixed(2)} exceeds your balance of $${playerBalance.toFixed(2)}.`;
                return;
            }

            const betComponents = calculateWagerFromTotalRisk(totalBetAmount, insuranceSelected);
            if (!betComponents) {
                messageBox.textContent = 'Invalid bet amount.';
                return;
            }

            const { wager, houseFee, insuranceCost } = betComponents;

            playerBalance -= totalBetAmount;
            playerNetProfitLoss -= totalBetAmount;
            totalCasinoProfit += houseFee + insuranceCost;
            addTransaction('bet_placement', -totalBetAmount, `Red/Black Bet: $${wager.toFixed(2)} (Fee: $${houseFee.toFixed(2)}, Ins: $${insuranceCost.toFixed(2)})`);
            updateBalanceDisplays();

            const card = generateBlackjackCard();
            const cardColor = ['Hearts', 'Diamonds'].includes(card.suit) ? 'red' : 'black';
            
            redBlackResultDisplay.innerHTML = '';
            const cardDiv = document.createElement('div');
            cardDiv.classList.add('card', cardColor);
            cardDiv.innerHTML = `<div class="value">${card.value}</div><div class="suit">${getSuitSymbol(card.suit)}</div>`;
            redBlackResultDisplay.appendChild(cardDiv);

            let playerWon = (cardColor === color);
            let winnings = playerWon ? wager * 2 : 0;
            
            setTimeout(() => {
                 handleGameEnd('Red or Black', playerWon, winnings, wager, insuranceSelected);
            }, 1000);
        }

        // --- Deal or No Deal Game functions ---
        function generateDealOrNoDealSequence() {
            const numbers = Array.from({length: 20}, (_, i) => i + 1);
            for (let i = numbers.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
            }
            return numbers;
        }

        function displayDealOrNoDealSequence(revealedSequence, playerChoice) {
            sequenceContainer.innerHTML = '';
            for (let i = 1; i <= 20; i++) {
                const numDiv = document.createElement('div');
                numDiv.classList.add('sequence-card');
                numDiv.textContent = i;
                if (revealedSequence.includes(i)) {
                    numDiv.classList.add('revealed');
                    if (i === playerChoice) {
                        numDiv.classList.add('player-choice');
                    }
                }
                sequenceContainer.appendChild(numDiv);
            }
        }

        function startDealOrNoDealGame() {
            const chosenNumber = parseInt(dealOrNoDealNumberInput.value);
            const totalBetAmount = parseFloat(dealOrNoDealBetInput.value);
            const insuranceSelected = document.getElementById('dond-insurance-checkbox').checked;

            if (isNaN(chosenNumber) || chosenNumber < 1 || chosenNumber > 20) {
                messageBox.textContent = 'Please choose a number between 1 and 20.';
                return;
            }
            if (totalBetAmount > playerBalance) {
                messageBox.textContent = `Insufficient funds. Your bet of $${totalBetAmount.toFixed(2)} exceeds your balance of $${playerBalance.toFixed(2)}.`;
                return;
            }

            const betComponents = calculateWagerFromTotalRisk(totalBetAmount, insuranceSelected);
            if (!betComponents) {
                messageBox.textContent = 'Invalid bet amount.';
                return;
            }

            const { wager, houseFee, insuranceCost } = betComponents;

            playerBalance -= totalBetAmount;
            playerNetProfitLoss -= totalBetAmount;
            totalCasinoProfit += houseFee + insuranceCost;
            addTransaction('bet_placement', -totalBetAmount, `DOND Bet: $${wager.toFixed(2)} (Fee: $${houseFee.toFixed(2)}, Ins: $${insuranceCost.toFixed(2)})`);
            updateBalanceDisplays();

            dealOrNoDealGame = {
                playerChoice: chosenNumber,
                wager: wager,
                insurancePurchased: insuranceSelected,
                sequence: generateDealOrNoDealSequence(),
                round: 0,
                revealedSequence: [],
            };

            startSequenceButton.disabled = true;
            dealOrNoDealResultDisplay.textContent = 'Round 1 starting...';
            displayDealOrNoDealSequence([], chosenNumber);
            setTimeout(runDealOrNoDealRound, 1500);
        }

        function runDealOrNoDealRound() {
            dealOrNoDealGame.round++;
            const numbersToReveal = 5;
            let revealedThisRound = 0;

            const revealInterval = setInterval(() => {
                if (revealedThisRound >= numbersToReveal || dealOrNoDealGame.sequence.length === 0) {
                    clearInterval(revealInterval);
                    
                    // Check if player's number was revealed
                    if (dealOrNoDealGame.revealedSequence.includes(dealOrNoDealGame.playerChoice)) {
                        dealOrNoDealResultDisplay.textContent = `Your number ${dealOrNoDealGame.playerChoice} was revealed. You lose.`;
                        handleGameEnd('Deal or No Deal', false, 0, dealOrNoDealGame.wager, dealOrNoDealGame.insurancePurchased);
                        resetDealOrNoDealUI();
                        return;
                    }

                    // Check for win condition (last number)
                    if (dealOrNoDealGame.sequence.length === 0 && !dealOrNoDealGame.revealedSequence.includes(dealOrNoDealGame.playerChoice)) {
                         const winnings = dealOrNoDealGame.wager * 20;
                         dealOrNoDealResultDisplay.textContent = `Your number was the last one standing!`;
                         handleGameEnd('Deal or No Deal', true, winnings, dealOrNoDealGame.wager, dealOrNoDealGame.insurancePurchased, `You win 20x your wager!`);
                         resetDealOrNoDealUI();
                         return;
                    }

                    // Offer a deal if game is not over
                    if (dealOrNoDealGame.round < 3) {
                        offerDeal();
                    } else { // Final round
                        dealOrNoDealResultDisplay.textContent = "Final round... revealing the rest!";
                        runDealOrNoDealRound(); // Continue to reveal remaining numbers
                    }
                    return;
                }

                const nextNumber = dealOrNoDealGame.sequence.pop();
                if (!dealOrNoDealGame.revealedSequence.includes(nextNumber)) {
                    dealOrNoDealGame.revealedSequence.push(nextNumber);
                    revealedThisRound++;
                    displayDealOrNoDealSequence(dealOrNoDealGame.revealedSequence, dealOrNoDealGame.playerChoice);
                }
            }, 500);
        }

        function offerDeal() {
            const payoutMultipliers = [0, 1.25, 2, 2.5]; // Index matches round number
            const multiplier = payoutMultipliers[dealOrNoDealGame.round];
            const offerAmount = dealOrNoDealGame.wager * multiplier;
            
            messageBox.textContent = `Round ${dealOrNoDealGame.round} is over. Your number is safe. The banker offers you $${offerAmount.toFixed(2)}.`;
            dealOrNoDealOptions.classList.remove('hidden');
            dealOrNoDealOptions.innerHTML = `
                <button id="accept-deal-button" class="bg-green-600 hover:bg-green-700">Take Deal ($${offerAmount.toFixed(2)})</button>
                <button id="reject-deal-button" class="bg-red-600 hover:bg-red-700">No Deal</button>
            `;

            document.getElementById('accept-deal-button').onclick = () => {
                handleGameEnd('Deal or No Deal', true, offerAmount, dealOrNoDealGame.wager, dealOrNoDealGame.insurancePurchased, `You accepted the deal.`);
                resetDealOrNoDealUI();
            };
            document.getElementById('reject-deal-button').onclick = () => {
                dealOrNoDealOptions.classList.add('hidden');
                messageBox.textContent = `You rejected the deal. Starting round ${dealOrNoDealGame.round + 1}...`;
                setTimeout(runDealOrNoDealRound, 1500);
            };
        }


        // --- Action button functions ---
        function withdrawFunds() {
            if (playerBalance <= 0) {
                messageBox.textContent = "You have no funds to withdraw.";
                return;
            }
            const withdrawalAmount = playerBalance;
            addTransaction('withdrawal', -withdrawalAmount, `Withdrawal of all funds`);
            playerBalance = 0;
            messageBox.textContent = `You have withdrawn $${withdrawalAmount.toFixed(2)}. Your balance is now $0.`;
            updateBalanceDisplays();
            gameSelection.classList.add('hidden');
            actionButtons.classList.add('hidden');
        }

        // Initialize display on load
        window.onload = () => {
            updateBalanceDisplays();
        };
    </script>
</body>
</html>
