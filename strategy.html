<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MMP TRADER'S MASTERBOOK | Algorithm Cracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background: #050505; color: #e5e5e5; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
        .panel { background: #0a0a0a; border: 1px solid #222; border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5); }
        .accent-text { color: #22c55e; }
        .danger-text { color: #ef4444; }
        input { background: #151515; border: 1px solid #333; color: #fff; padding: 8px 12px; border-radius: 4px; width: 100%; outline: none; transition: border 0.2s; }
        input:focus { border-color: #22c55e; }
        .tier-row:hover { background: #111; }
        .best-choice { background: rgba(34, 197, 94, 0.1); border-left: 4px solid #22c55e; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }
    </style>
</head>
<body class="p-4 md:p-8 max-w-7xl mx-auto min-h-screen flex flex-col">

    <!-- Header -->
    <header class="mb-8 border-b border-gray-800 pb-6 flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
        <div>
            <h1 class="text-3xl font-bold tracking-tighter text-white mb-1">TRADER'S <span class="text-yellow-500">MASTERBOOK</span></h1>
            <p class="text-xs text-gray-500 uppercase tracking-widest">Algorithm Analysis & Probability Engine v2.0</p>
        </div>
        <div class="text-right">
            <div class="text-[10px] text-gray-600 uppercase font-bold mb-1">System Status</div>
            <div class="inline-flex items-center gap-2 px-3 py-1 bg-green-900/20 border border-green-900/50 rounded text-green-500 text-xs font-bold">
                <span class="relative flex h-2 w-2">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                </span>
                LIVE CALCULATOR
            </div>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <!-- Controls & Inputs -->
        <div class="lg:col-span-4 space-y-6">
            <div class="panel p-6">
                <h2 class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-6 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" /></svg>
                    Simulation Parameters
                </h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="text-[10px] uppercase font-bold text-gray-500 mb-1 block">Current Stealth Pot ($)</label>
                        <input type="number" id="input-pot" value="0" placeholder="Enter Pot Size from Game" oninput="calculate()">
                        <p class="text-[9px] text-gray-600 mt-1">Found in game console or estimated from missed range.</p>
                    </div>

                    <div>
                        <label class="text-[10px] uppercase font-bold text-gray-500 mb-1 block">Winning Streak</label>
                        <input type="number" id="input-streak" value="0" placeholder="Current Win Streak" oninput="calculate()">
                        <p class="text-[9px] text-gray-600 mt-1">Increases win probability by tier boost %.</p>
                    </div>

                    <div class="pt-4 border-t border-gray-800">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-[10px] uppercase font-bold text-gray-500">Execution Cost</span>
                            <span class="text-sm font-bold text-red-400">$199.00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-[10px] uppercase font-bold text-gray-500">Scalp Entry Value</span>
                            <span class="text-sm font-bold text-green-400">~$224.00</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel p-6 bg-blue-900/5 border-blue-900/20">
                <h3 class="text-blue-400 font-bold text-xs uppercase tracking-widest mb-2">The "Pot" Mechanic</h3>
                <p class="text-xs text-gray-400 leading-relaxed mb-4">
                    The game hides a "Stealth Fund" (Pot). When you sell early, the remaining profit potential is added to the Pot. 
                    <br><br>
                    <strong class="text-white">Formula:</strong> Next Max Win = Base Payout + Pot.
                </p>
                <div class="text-[10px] text-gray-500 italic">
                    Use this calculator to determine when the Pot is large enough to make high-risk tiers mathematically profitable.
                </div>
            </div>
        </div>

        <!-- Main Data Table -->
        <div class="lg:col-span-8 space-y-6">
            <div class="panel overflow-hidden">
                <div class="p-4 border-b border-gray-800 bg-gray-900/50 flex justify-between items-center">
                    <h2 class="text-xs font-bold text-white uppercase tracking-widest">Live Strategy Matrix</h2>
                    <span class="text-[10px] text-gray-500">UPDATES IN REAL-TIME</span>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="text-[9px] text-gray-500 uppercase tracking-wider bg-black/20">
                                <th class="p-4">Tier</th>
                                <th class="p-4 text-right">Win Chance</th>
                                <th class="p-4 text-right">Target Price</th>
                                <th class="p-4 text-right">Scalp EV</th>
                                <th class="p-4 text-right">Hold EV</th>
                                <th class="p-4 text-center">Verdict</th>
                            </tr>
                        </thead>
                        <tbody id="strategy-table-body" class="text-sm font-mono">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="panel p-4">
                    <h3 class="text-[10px] font-bold text-gray-500 uppercase mb-4">Risk / Reward Ratio (Hold Strategy)</h3>
                    <canvas id="evChart" height="200"></canvas>
                </div>
                <div class="panel p-6 flex flex-col justify-center">
                    <h3 class="text-[10px] font-bold text-gray-500 uppercase mb-4">Master Strategy Guide</h3>
                    <ul class="space-y-3 text-xs text-gray-300">
                        <li class="flex gap-3">
                            <span class="text-yellow-500 font-bold">1.</span>
                            <span>If Pot is <span class="text-white font-bold">$0</span>, ALWAYS use <span class="text-green-400">Micro/Small Cap</span> and <span class="text-red-400 font-bold">SCALP</span> (Sell Instantly).</span>
                        </li>
                        <li class="flex gap-3">
                            <span class="text-yellow-500 font-bold">2.</span>
                            <span>The entry price on a win is ~$225. Micro Cap target is only $150. Holding guarantees a loss even if you win. <span class="text-green-400 font-bold">SELL IMMEDIATELY.</span></span>
                        </li>
                        <li class="flex gap-3">
                            <span class="text-yellow-500 font-bold">3.</span>
                            <span>Switch to <span class="text-blue-400">Institutional</span> ONLY when Pot > $800. The Expected Value (EV) flips positive because the 15% win chance pays out massive amounts.</span>
                        </li>
                        <li class="flex gap-3">
                            <span class="text-yellow-500 font-bold">4.</span>
                            <span>Don't fear the "Stop Loss". In this game, a "Stop Loss" (Ticker < Bias) is actually the algorithm pushing price to the target.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

<script>
    // Game Constants derived from source code
    const COST = 199;
    const SCALP_ENTRY_AVG = 224; // (199 + 249) / 2
    const LOSS_SETTLEMENT = 10; // Bias is 10 on loss
    const BIAS_FACTOR = 0.85;

    const TIERS = [
        { id: 0, label: 'MICRO CAP', payout: 150, baseOdds: 75, boost: 5 },
        { id: 1, label: 'SMALL CAP', payout: 200, baseOdds: 60, boost: 5 },
        { id: 2, label: 'MID CAP', payout: 300, baseOdds: 40, boost: 5 },
        { id: 3, label: 'LARGE CAP', payout: 400, baseOdds: 30, boost: 5 },
        { id: 4, label: 'MEGA CAP', payout: 500, baseOdds: 20, boost: 5 },
        { id: 5, label: 'INSTITUTIONAL', payout: 1000, baseOdds: 15, boost: 2.5 }
    ];

    let evChartInstance = null;

    function calculate() {
        const pot = parseFloat(document.getElementById('input-pot').value) || 0;
        const streak = parseFloat(document.getElementById('input-streak').value) || 0;
        
        const tbody = document.getElementById('strategy-table-body');
        tbody.innerHTML = '';

        const evData = [];
        const labels = [];
        let bestTierId = -1;
        let maxEV = -99999;

        TIERS.forEach(tier => {
            // 1. Calculate Odds
            const winChance = Math.min(100, tier.baseOdds + (streak * tier.boost)) / 100;
            const loseChance = 1 - winChance;

            // 2. Calculate Target Prices
            // If we hold, price trends to Bias.
            // Win Bias = (Payout + Pot) * 0.85
            const holdWinPayout = (tier.payout + pot) * BIAS_FACTOR;
            const holdLosePayout = LOSS_SETTLEMENT;

            // 3. Calculate Scalp Values
            // If we scalp, we sell immediately at Entry (approx 224) if win.
            // If lose, we sell at random start (0-25), avg 12.5.
            const scalpWinPayout = SCALP_ENTRY_AVG;
            const scalpLosePayout = 12.5;

            // 4. Calculate EV (Expected Value)
            // EV = (ProbWin * PayWin) + (ProbLoss * PayLoss) - Cost
            const evHold = (winChance * holdWinPayout) + (loseChance * holdLosePayout) - COST;
            const evScalp = (winChance * scalpWinPayout) + (loseChance * scalpLosePayout) - COST;

            // Determine Strategy
            const isHoldBetter = evHold > evScalp;
            const bestEV = Math.max(evHold, evScalp);
            
            // Track Best
            if (bestEV > maxEV) {
                maxEV = bestEV;
                bestTierId = tier.id;
            }

            // Chart Data
            evData.push(evHold);
            labels.push(tier.label);

            // Row HTML
            const tr = document.createElement('tr');
            tr.className = `tier-row border-b border-gray-800 transition-colors ${bestEV === maxEV ? 'best-choice-temp' : ''}`; // We'll fix class later
            
            // Formatting
            const fmtMoney = (n) => `$${n.toFixed(0)}`;
            const fmtEV = (n) => {
                const s = n.toFixed(2);
                return n > 0 ? `<span class="text-green-400">+${s}</span>` : `<span class="text-red-500">${s}</span>`;
            };

            tr.innerHTML = `
                <td class="p-4 font-bold text-gray-300">
                    <div class="text-xs">${tier.label}</div>
                    <div class="text-[9px] text-gray-600">Base: $${tier.payout}</div>
                </td>
                <td class="p-4 text-right font-bold text-blue-400">${(winChance*100).toFixed(0)}%</td>
                <td class="p-4 text-right text-gray-400">${fmtMoney(holdWinPayout)}</td>
                <td class="p-4 text-right font-mono text-xs">${fmtEV(evScalp)}</td>
                <td class="p-4 text-right font-mono text-xs border-l border-gray-800 bg-gray-900/20">${fmtEV(evHold)}</td>
                <td class="p-4 text-center">
                    ${bestEV > 0 
                        ? `<span class="px-2 py-1 rounded bg-green-900/30 text-green-400 text-[10px] font-bold border border-green-800">${isHoldBetter ? 'HOLD' : 'SCALP'}</span>`
                        : `<span class="px-2 py-1 rounded bg-red-900/20 text-red-500 text-[10px] font-bold border border-red-900/50">AVOID</span>`
                    }
                </td>
            `;
            tbody.appendChild(tr);
        });

        // Highlight best row visually
        const rows = tbody.querySelectorAll('tr');
        rows.forEach((r, i) => {
            if (TIERS[i].id === bestTierId) {
                r.classList.add('best-choice');
            }
        });

        updateChart(labels, evData);
    }

    function updateChart(labels, data) {
        const ctx = document.getElementById('evChart').getContext('2d');
        
        if (evChartInstance) {
            evChartInstance.destroy();
        }

        evChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels.map(l => l.split(' ')[0]), // Shorten labels
                datasets: [{
                    label: 'Expected Profit (Hold Strategy)',
                    data: data,
                    backgroundColor: data.map(v => v >= 0 ? '#22c55e' : '#ef4444'),
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        grid: { color: '#222' },
                        ticks: { color: '#666', callback: (v) => '$' + v }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: '#888', font: { size: 10 } }
                    }
                }
            }
        });
    }

    // Init
    window.onload = calculate;
</script>
</body>
</html>
