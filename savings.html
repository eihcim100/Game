<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InstantFund: Resilience Subscription</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-bg: #111827;
            --card-bg: #1F2937;
            --accent: #059669;
            --accent-hover: #10B981;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--brand-bg); color: #f3f4f6; }
        .app-card { background-color: var(--card-bg); max-width: 500px; width: 100%; border-radius: 16px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5); }
        
        .btn { transition: all 0.2s; font-weight: 600; border-radius: 0.5rem; padding: 0.75rem 1rem; width: 100%; }
        .btn-primary { background-color: var(--accent); color: white; }
        .btn-primary:hover:not(:disabled) { background-color: var(--accent-hover); transform: translateY(-1px); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }
        
        .btn-warning { background-color: #F59E0B; color: #111827; }
        .btn-warning:hover:not(:disabled) { background-color: #FBBF24; }
        .btn-warning:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-danger { background-color: #DC2626; color: white; }
        .btn-danger:hover { background-color: #EF4444; }
        
        .btn-titanium { background: linear-gradient(135deg, #e5e7eb 0%, #9ca3af 100%); color: #1f2937; }
        .btn-titanium:hover { background: linear-gradient(135deg, #f3f4f6 0%, #d1d5db 100%); }

        .tier-card { transition: all 0.2s; border: 2px solid transparent; }
        .tier-card.active { border-color: var(--accent); background-color: #374151; }
        
        .progress-bar { transition: width 0.1s linear; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="app" class="app-card p-6">
        <!-- Header -->
        <div class="flex justify-between items-start mb-6 border-b border-gray-700 pb-4">
            <div>
                <h1 class="text-2xl font-bold text-white">InstantFund</h1>
                <p class="text-xs text-gray-400 mt-1">Resilience Subscription</p>
            </div>
            <div id="statusBadge" class="px-3 py-1 text-xs font-bold uppercase tracking-wide rounded-full bg-red-900 text-red-200">
                Unpaid
            </div>
        </div>

        <!-- Tier Selection -->
        <div class="mb-6">
            <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3 text-center text-gray-300">Coverage Level</h3>
            <div id="tierGrid" class="grid grid-cols-5 gap-2"></div>
        </div>

        <!-- Metrics Dashboard -->
        <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-gray-800 p-3 rounded-lg text-center border border-gray-700 relative overflow-hidden">
                <div class="text-[10px] text-gray-400 uppercase mb-1 tracking-tighter">Total Paid (Lifetime)</div>
                <div id="displayTotalPaid" class="text-xl font-bold text-gray-300">$0</div>
            </div>
            <div class="bg-gray-800 p-3 rounded-lg text-center border border-gray-700 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-1 h-full bg-green-500"></div>
                <div class="text-[10px] text-gray-400 uppercase mb-1 tracking-tighter">Total Value Received</div>
                <div id="displayTotalReceived" class="text-xl font-bold text-green-400">$0</div>
            </div>
        </div>
        
        <div class="bg-gray-800 p-3 rounded-lg text-center border border-gray-700 mb-6">
            <div class="text-[10px] text-gray-400 uppercase mb-1 tracking-tighter">Current Monthly Premium</div>
            <div id="displayPremium" class="text-2xl font-bold text-yellow-400">$199</div>
        </div>

        <!-- Claims Context -->
        <div class="grid grid-cols-2 gap-3 mb-6">
            <div class="bg-gray-800 p-3 rounded-lg text-center">
                <div class="text-xs text-gray-400 mb-1">Emergency Payout</div>
                <div id="displayPayout" class="text-lg font-bold text-white">$500</div>
            </div>
            <div class="bg-gray-800 p-3 rounded-lg text-center">
                <div class="text-xs text-gray-400 mb-1">Approval Odds</div>
                <div id="displayOdds" class="text-lg font-bold text-blue-400">20%</div>
            </div>
        </div>

        <!-- Main Action Area -->
        <div class="mb-4 relative">
            <button id="btnClaim" class="btn btn-primary text-lg shadow-lg">Request Funds</button>
            <div id="processingOverlay" class="absolute inset-0 bg-gray-800 rounded-lg flex flex-col items-center justify-center hidden z-10">
                <span class="text-sm font-semibold mb-2 text-blue-300">Analyzing Liquidity...</span>
                <div class="w-3/4 h-2 bg-gray-700 rounded-full overflow-hidden">
                    <div id="progressBar" class="h-full bg-blue-500 w-0 progress-bar"></div>
                </div>
            </div>
        </div>

        <!-- Simulation Tools & Controls -->
        <div class="border-t border-gray-700 pt-4 mt-6">
            <p class="text-xs text-center text-gray-500 mb-3 uppercase tracking-widest font-bold">Loyalty & Risk Control</p>
            
            <div id="freezeOption" class="bg-gray-900 p-4 rounded-lg flex items-center justify-between mb-4 border border-dashed border-gray-600 transition-opacity duration-200">
                <label for="inputFreeze" class="text-gray-200 flex flex-col cursor-pointer flex-1">
                    <span class="font-bold flex items-center">
                        <input type="checkbox" id="inputFreeze" onchange="toggleFreeze()" class="mr-3 h-5 w-5 text-emerald-600 bg-gray-700 border-gray-600 rounded focus:ring-emerald-500">
                        SAFETY FREEZE
                    </span>
                    <span id="freezeLabelText" class="text-[10px] text-gray-400 mt-1 pl-8">Neutralize risk now for $20 off NEXT bill</span>
                </label>
                <div class="flex flex-col items-end">
                    <span id="freezeDiscountDisplay" class="text-yellow-400 font-bold text-xs mb-1">Save $20</span>
                    <div id="freezeStatusIcon" class="text-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Upgrade Option (Hidden by default) -->
            <button id="btnUpgrade" class="btn btn-titanium text-sm mb-3 hidden shadow-lg border border-white/20">
                ‚≠ê Upgrade to Titanium ($1000 Payout)
            </button>

            <div class="grid grid-cols-2 gap-3 mb-3">
                <button id="btnPay" class="btn bg-blue-700 hover:bg-blue-600 text-white text-sm shadow-md">Activate Account</button>
                <button id="btnMiss" class="btn bg-red-900 hover:bg-red-800 text-white text-sm shadow-md">Miss Payment</button>
            </div>

            <button id="btnCashOut" class="btn btn-warning text-sm mb-3 shadow-md">Cash Out & Cancel</button>
            <button id="btnReset" class="text-xs text-gray-500 hover:text-white w-full underline">Hard Reset Demo</button>
        </div>
    </div>

    <!-- Modal Interface -->
    <div id="modalOverlay" class="fixed inset-0 bg-black/80 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-xl max-w-sm w-full p-6 shadow-2xl border-t-4 border-emerald-500" id="modalContainer">
            <h3 id="modalTitle" class="text-xl font-bold text-white mb-2">Title</h3>
            <div id="modalBody" class="text-gray-300 text-sm mb-6 leading-relaxed">Message</div>
            <div id="modalActions" class="flex gap-3"></div>
        </div>
    </div>

<script>
    const CONFIG = {
        STORAGE_KEY: 'IF_State_Payout_Tracker_v3',
        INITIAL_PREMIUM: 199,
        TITANIUM_PREMIUM: 349,
        TITANIUM_PAYOUT: 1000,
        BASE_PREMIUM_FLOOR: 49,
        PREMIUM_DROP: 10,
        ACF_PER_MONTH: 30,
        ODDS_BOOST: 5,
        M1_REFUND_CHANCE: 0.20,
        M1_REFUND_AMOUNT: 199,
        YEAR_ONE_BONUS: 300,
        M6_BONUS_PERCENT: 0.50,
        M6_MONTH: 6,
        FREEZE_DISCOUNT: 20,
        TITANIUM_SIGNING_BONUS: 250, 
        TIERS: [
            { id: 1, label: 'Tier 1', payout: 150, baseOdds: 75 },
            { id: 2, label: 'Tier 2', payout: 200, baseOdds: 60 },
            { id: 3, label: 'Tier 3', payout: 300, baseOdds: 40 },
            { id: 4, label: 'Tier 4', payout: 400, baseOdds: 30 },
            { id: 5, label: 'Tier 5', payout: 500, baseOdds: 20 },
            { id: 6, label: 'Titanium', payout: 1000, baseOdds: 20 }
        ]
    };

    let state = {
        tierId: 5,
        premium: CONFIG.INITIAL_PREMIUM,
        monthsPaid: 0,
        isPaid: false,
        acfBalance: 0,
        lastClaimTime: 0,
        m6BonusPaid: false,
        isFrozen: false,
        totalPaid: 0,
        totalReceived: 0
    };

    function init() {
        const saved = localStorage.getItem(CONFIG.STORAGE_KEY);
        if (saved) {
            try {
                const parsed = JSON.parse(saved);
                state = { ...state, ...parsed };
            } catch (e) {
                resetApp();
                return;
            }
        }
        render();
    }

    function saveState() {
        localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(state));
    }

    function resetApp() {
        state = {
            tierId: 5,
            premium: CONFIG.INITIAL_PREMIUM,
            monthsPaid: 0,
            isPaid: false,
            acfBalance: 0,
            lastClaimTime: 0,
            m6BonusPaid: false,
            isFrozen: false,
            totalPaid: 0,
            totalReceived: 0
        };
        saveState();
        render();
        showModal("System Reset", "All historical simulation data has been cleared.");
    }

    function getCurrentOdds() {
        const tier = CONFIG.TIERS.find(t => t.id === state.tierId);
        const bonus = state.monthsPaid * CONFIG.ODDS_BOOST;
        return Math.min(100, tier.baseOdds + bonus);
    }

    function getBillAmount() {
        if (!state.isPaid && state.monthsPaid === 0) return state.premium;
        let bill = state.premium;
        if (state.isFrozen) {
            bill = Math.max(CONFIG.BASE_PREMIUM_FLOOR, bill - CONFIG.FREEZE_DISCOUNT);
        }
        return bill;
    }

    window.toggleFreeze = function() {
        const checkbox = document.getElementById('inputFreeze');
        
        if (state.lastClaimTime > 0) {
            showModal("Freeze Unavailable", "You have already accessed funds this cycle. You cannot freeze your account until the start of the next billing period.");
            checkbox.checked = false; 
            return;
        }

        state.isFrozen = checkbox.checked;
        saveState();
        render();
    }

    window.switchTier = function(newId) {
        if (state.tierId === 6) {
             showModal("Downgrade Restricted", "Titanium Tier members cannot downgrade via this menu.");
             return;
        }
        state.tierId = newId;
        saveState();
        render();
    }

    window.upgradeTier = function() {
        const totalTransitionBonus = state.acfBalance + CONFIG.TITANIUM_SIGNING_BONUS;
        
        showModal("Titanium Upgrade", 
            `Upgrade to <b>$1,000 Coverage</b> for a base premium of <b>$349/mo</b>?<br><br>
            <div class="bg-gray-900 p-3 rounded border border-gray-700 mb-3">
                <span class="text-green-400 font-bold">INSTANT UPGRADE BONUS: $${totalTransitionBonus.toFixed(2)}</span><br>
                <span class="text-xs text-gray-400">Includes 100% of your ACF ($${state.acfBalance.toFixed(2)}) + $${CONFIG.TITANIUM_SIGNING_BONUS} Signing Bonus.</span>
            </div>
            This bonus will be paid to you immediately. Your cycle will then reset to Month 0 at the new tier.`, 
            `<button onclick="closeModal()" class="btn bg-gray-600 flex-1">Cancel</button>
             <button onclick="window.confirmUpgrade(${totalTransitionBonus})" class="btn btn-primary flex-1">Accept & Upgrade</button>`
        );
    }

    window.confirmUpgrade = function(bonusAmount) {
        state.totalReceived += bonusAmount;
        state.tierId = 6; 
        state.premium = CONFIG.TITANIUM_PREMIUM;
        state.monthsPaid = 0; 
        state.isPaid = false; 
        state.acfBalance = 0; 
        state.lastClaimTime = 0;
        state.m6BonusPaid = false;
        
        closeModal();
        saveState();
        render();
        
        setTimeout(() => {
            showModal("Welcome to Titanium", `We have transferred your <b>$${bonusAmount.toFixed(2)}</b> upgrade bonus! Please pay the initial premium to activate your $1,000 coverage.`);
        }, 300);
    }

    function payBill() {
        const amountToCharge = getBillAmount();
        let msg = "";
        let extraBonusMsg = "";

        state.totalPaid += amountToCharge;

        if (!state.isPaid) {
            state.isPaid = true;
            if (state.monthsPaid === 0) {
                state.monthsPaid = 1;
                state.acfBalance += CONFIG.ACF_PER_MONTH;
                const baseStart = state.tierId === 6 ? CONFIG.TITANIUM_PREMIUM : CONFIG.INITIAL_PREMIUM;
                state.premium = Math.max(CONFIG.BASE_PREMIUM_FLOOR, baseStart - CONFIG.PREMIUM_DROP);
                msg = `Initial premium of $${amountToCharge} paid. Account activated.`;
            } else {
                msg = `Payment of $${amountToCharge} processed. Account is active.`;
            }
        } else {
            state.monthsPaid++;
            state.acfBalance += CONFIG.ACF_PER_MONTH;
            state.lastClaimTime = 0;
            state.premium = Math.max(CONFIG.BASE_PREMIUM_FLOOR, state.premium - CONFIG.PREMIUM_DROP);
            
            if (state.monthsPaid === CONFIG.M6_MONTH && !state.m6BonusPaid) {
                const bonus = Math.floor(state.acfBalance * CONFIG.M6_BONUS_PERCENT);
                state.acfBalance -= bonus;
                state.totalReceived += bonus; 
                state.m6BonusPaid = true;
                extraBonusMsg += `<br><br><span class='text-green-400 font-bold'>6-MONTH PAYOUT:</span> You received a $${bonus} cash bonus!`;
            } else if (state.monthsPaid === 12) {
                state.acfBalance += CONFIG.YEAR_ONE_BONUS;
                extraBonusMsg += `<br><br><span class='text-yellow-400 font-bold'>ANNIVERSARY BONUS:</span> $${CONFIG.YEAR_ONE_BONUS} added to your fund!`;
            }

            msg = `Payment of $${amountToCharge} processed. Advanced to Month ${state.monthsPaid}. ${extraBonusMsg}`;
        }
        
        state.isFrozen = false; 
        saveState();
        render();
        showModal("Payment Confirmed", msg);
    }

    function finalizeClaim() {
        const tier = CONFIG.TIERS.find(t => t.id === state.tierId);
        const odds = getCurrentOdds();
        const passed = (Math.random() * 100) <= odds;

        document.getElementById('processingOverlay').classList.add('hidden');
        document.getElementById('btnClaim').disabled = false;

        if (passed) {
            let payout = tier.payout;
            if (state.monthsPaid >= 12) payout += CONFIG.YEAR_ONE_BONUS;
            
            state.totalReceived += payout; 

            const baseStart = state.tierId === 6 ? CONFIG.TITANIUM_PREMIUM : CONFIG.INITIAL_PREMIUM;
            state.premium = baseStart;
            state.monthsPaid = 0;
            state.acfBalance = 0;
            state.lastClaimTime = Date.now();
            state.m6BonusPaid = false;
            state.isFrozen = false;
            showModal("‚úÖ Request Approved", `Emergency Funds of $${payout} have been transferred.`);
        } else {
            let refund = state.acfBalance;
            if (state.monthsPaid === 1 && Math.random() <= CONFIG.M1_REFUND_CHANCE) refund += CONFIG.M1_REFUND_AMOUNT;
            
            state.totalReceived += refund; 
            
            state.acfBalance = 0;
            state.lastClaimTime = Date.now();
            showModal("Request Denied", `Current liquidity odds: ${odds}%. Loyalty payout of $${refund.toFixed(2)} issued.`);
        }
        saveState();
        render();
    }

    function attemptClaim() {
        if (state.isFrozen) return;
        const btn = document.getElementById('btnClaim');
        const overlay = document.getElementById('processingOverlay');
        const bar = document.getElementById('progressBar');
        btn.disabled = true;
        overlay.classList.remove('hidden');
        let w = 0;
        const iv = setInterval(() => {
            w += 5;
            bar.style.width = w + '%';
            if (w >= 100) { clearInterval(iv); finalizeClaim(); }
        }, 50);
    }

    function render() {
        const tier = CONFIG.TIERS.find(t => t.id === state.tierId);
        const currentBill = getBillAmount();

        const setVal = (id, val) => {
            const el = document.getElementById(id);
            if (el) el.innerText = val;
        };

        setVal('displayTotalPaid', `$${state.totalPaid}`);
        setVal('displayTotalReceived', `$${state.totalReceived}`);
        setVal('displayPremium', `$${state.premium}`);
        setVal('displayPayout', `$${tier.payout}`);
        setVal('displayOdds', `${getCurrentOdds()}%`);

        const badge = document.getElementById('statusBadge');
        if (badge) {
            badge.innerText = state.isPaid ? `Active ‚Ä¢ Month ${state.monthsPaid}` : "Unpaid";
            badge.className = `px-3 py-1 text-xs font-bold uppercase rounded-full ${state.isPaid ? 'bg-green-900 text-green-200' : 'bg-red-900 text-red-200'}`;
        }

        const grid = document.getElementById('tierGrid');
        if (grid) {
            grid.innerHTML = CONFIG.TIERS.slice(0, 5).map(t => `
                <div onclick="switchTier(${t.id})" class="tier-card ${state.tierId === t.id ? 'active' : 'bg-gray-800'} p-2 rounded cursor-pointer text-center hover:bg-gray-700">
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-tighter">${t.label}</div>
                    <div class="text-sm text-blue-400 font-bold">$${t.payout}</div>
                </div>`).join('');
            
            if (state.tierId === 6) {
                grid.innerHTML = `<div class="col-span-5 bg-gradient-to-r from-gray-200 to-gray-400 text-gray-900 p-2 rounded text-center font-bold text-sm shadow-md">
                    TITANIUM TIER ($1,000 Payout)
                </div>`;
            }
        }

        const btnPay = document.getElementById('btnPay');
        if (btnPay) {
            if (state.isPaid) {
                btnPay.innerText = `Advance Month ($${currentBill})`;
                btnPay.classList.replace('bg-blue-700', 'bg-green-700');
            } else {
                btnPay.innerText = state.monthsPaid === 0 ? `Activate Account ($${currentBill})` : `Re-activate ($${currentBill})`;
                btnPay.classList.replace('bg-green-700', 'bg-blue-700');
            }
        }

        const btnClaim = document.getElementById('btnClaim');
        if (btnClaim) {
            const isLocked = !state.isPaid || state.lastClaimTime > 0 || state.isFrozen;
            btnClaim.disabled = isLocked;
            
            if (state.isFrozen) {
                btnClaim.innerText = "ACCESS FROZEN";
                btnClaim.classList.add('opacity-50', 'bg-gray-600');
                btnClaim.classList.remove('btn-primary');
                document.getElementById('freezeStatusIcon').innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>`;
            } else {
                btnClaim.innerText = state.lastClaimTime > 0 ? "Used this Cycle" : "Request Funds";
                if(isLocked) {
                    btnClaim.classList.add('opacity-50', 'bg-gray-600');
                    btnClaim.classList.remove('btn-primary');
                } else {
                    btnClaim.classList.remove('opacity-50', 'bg-gray-600');
                    btnClaim.classList.add('btn-primary');
                }
                document.getElementById('freezeStatusIcon').innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z" /></svg>`;
            }
        }

        const freezeLabel = document.getElementById('freezeDiscountDisplay');
        const freezeContainer = document.getElementById('freezeOption');
        const freezeText = document.getElementById('freezeLabelText');
        const freezeInput = document.getElementById('inputFreeze');

        if (freezeLabel) {
            const canFreeze = state.isPaid && state.lastClaimTime === 0;
            freezeInput.disabled = !canFreeze;
            
            if (!canFreeze) {
                freezeContainer.classList.add('opacity-50', 'cursor-not-allowed');
                freezeText.innerText = state.lastClaimTime > 0 ? "Service used. Freeze unavailable." : "Pay bill to enable options";
            } else {
                freezeContainer.classList.remove('opacity-50', 'cursor-not-allowed');
                freezeText.innerText = "Neutralize risk now for $20 off NEXT bill";
            }

            if (state.isFrozen) {
                freezeLabel.innerText = "-$20 Discount Locked";
                freezeLabel.className = "text-emerald-400 font-bold italic text-[10px]";
            } else {
                freezeLabel.innerText = "Save $20";
                freezeLabel.className = "text-yellow-400 font-bold text-sm";
            }
        }

        const btnUpgrade = document.getElementById('btnUpgrade');
        if (state.monthsPaid >= 12 && state.tierId !== 6) {
            btnUpgrade.classList.remove('hidden');
            btnUpgrade.onclick = window.upgradeTier;
        } else {
            btnUpgrade.classList.add('hidden');
        }

        document.getElementById('btnCashOut').disabled = !state.isPaid || state.monthsPaid < 1;
        document.getElementById('btnMiss').disabled = !state.isPaid;
        if (freezeInput) freezeInput.checked = state.isFrozen;
    }

    function showModal(title, body, actions = null) {
        document.getElementById('modalTitle').innerText = title;
        document.getElementById('modalBody').innerHTML = body;
        document.getElementById('modalActions').innerHTML = actions || `<button onclick="closeModal()" class="btn btn-primary">Understood</button>`;
        document.getElementById('modalOverlay').classList.remove('hidden');
    }

    window.closeModal = () => document.getElementById('modalOverlay').classList.add('hidden');

    document.getElementById('btnPay').onclick = payBill;
    document.getElementById('btnMiss').onclick = () => {
        showModal("Confirm Cancellation", "Warning: Missing a payment will cancel your account and wipe your loyalty progress.", 
        `<button onclick="closeModal()" class="btn bg-gray-600 flex-1">Back</button><button onclick="window.confirmMiss()" class="btn btn-danger flex-1">End Policy</button>`);
    };
    window.confirmMiss = () => {
        resetApp();
        closeModal();
    }
    document.getElementById('btnClaim').onclick = attemptClaim;
    document.getElementById('btnReset').onclick = resetApp;
    document.getElementById('btnCashOut').onclick = () => {
        const tier = CONFIG.TIERS.find(t => t.id === state.tierId);
        const total = state.acfBalance + (tier.payout * (getCurrentOdds()/100) * 0.5);
        showModal("Cash Out Benefit", `Final Buy-Back Amount: $${total.toFixed(2)}`, `<button onclick="closeModal()" class="btn bg-gray-600 flex-1">Stay</button><button onclick="window.confirmCashOut(${total})" class="btn btn-warning flex-1">Accept & Exit</button>`);
    };
    window.confirmCashOut = function(amt) {
        state.totalReceived += amt; 
        resetApp();
        setTimeout(() => showModal("üí∞ Funds Sent", `Your cash-out of $${amt.toFixed(2)} has been paid. Account closed.`), 100);
    }

    init();
</script>
</body>
</html>
